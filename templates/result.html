{% extends "base.html" %}

{% block title %}AI Escape Room ‚Äî {{ "Escaped!" if breakdown.victory else "Time's Up!" }}{% endblock %}

{% block content %}
<div class="min-h-screen flex flex-col items-center justify-center px-4 py-16 room-{{ theme }}"
     data-result-victory="{{ 'true' if breakdown.victory else 'false' }}"
     style="--accent: {{ theme_data.gradient_to }}; --accent-dim: {{ theme_data.gradient_from }}; --accent-alpha: {{ theme_data.gradient_to }}33;">

    <!-- Result header -->
    <div class="text-center mb-10 animate-slide-up">
        {% if breakdown.victory %}
        <div class="text-7xl mb-5 animate-float" id="victory-emoji">üéâ</div>
        <h1 class="font-display text-5xl md:text-6xl font-bold mb-3">
            <span class="bg-gradient-to-r from-emerald-400 to-green-300 bg-clip-text text-transparent" id="victory-title">
                You Escaped!
            </span>
        </h1>
        <p class="text-gray-500 text-lg">You solved all puzzles in the {{ theme_data.name }}.</p>
        {% else %}
        <div class="text-7xl mb-5">‚è∞</div>
        <h1 class="font-display text-5xl md:text-6xl font-bold mb-3">
            <span class="bg-gradient-to-r from-red-400 to-rose-300 bg-clip-text text-transparent">
                Time's Up
            </span>
        </h1>
        <p class="text-gray-500 text-lg">The {{ theme_data.name }} claimed another soul...</p>
        {% endif %}
    </div>

    <!-- Score card -->
    <div class="w-full max-w-lg rounded-2xl border border-white/[0.08] bg-white/[0.02] backdrop-blur-sm p-8 mb-8 animate-scale-in"
         style="box-shadow: 0 0 80px -30px var(--accent-alpha);">

        <!-- Total score -->
        <div class="text-center mb-8 pb-8 border-b border-white/[0.06]">
            <div class="text-[11px] text-gray-600 uppercase tracking-[0.2em] mb-2">Final Score</div>
            <div class="font-display text-6xl font-bold" style="color: var(--accent);">{{ breakdown.total_score }}</div>
        </div>

        <!-- Stats grid -->
        <div class="grid grid-cols-2 gap-3 mb-8">
            <div class="rounded-xl bg-white/[0.03] border border-white/[0.04] p-4 text-center">
                <div class="font-display text-2xl font-bold text-white">{{ breakdown.puzzles_solved }}/{{ breakdown.total_puzzles }}</div>
                <div class="text-[10px] text-gray-600 mt-1 uppercase tracking-widest">Puzzles Solved</div>
            </div>
            <div class="rounded-xl bg-white/[0.03] border border-white/[0.04] p-4 text-center">
                <div class="font-display text-2xl font-bold text-white">{{ (breakdown.total_time / 60) | round(1) }}m</div>
                <div class="text-[10px] text-gray-600 mt-1 uppercase tracking-widest">Total Time</div>
            </div>
            <div class="rounded-xl bg-white/[0.03] border border-white/[0.04] p-4 text-center">
                <div class="font-display text-2xl font-bold text-white">{{ breakdown.total_hints }}</div>
                <div class="text-[10px] text-gray-600 mt-1 uppercase tracking-widest">Hints Used</div>
            </div>
            <div class="rounded-xl bg-white/[0.03] border border-white/[0.04] p-4 text-center">
                <div class="font-display text-2xl font-bold text-white">{{ (breakdown.time_penalties / 60) | round(1) }}m</div>
                <div class="text-[10px] text-gray-600 mt-1 uppercase tracking-widest">Time Penalties</div>
            </div>
        </div>

        <!-- Puzzle breakdown -->
        <div>
            <div class="text-[11px] text-gray-600 uppercase tracking-[0.15em] mb-3">Puzzle Breakdown</div>
            <div class="space-y-2">
                {% for p in breakdown.puzzle_details %}
                <div class="flex items-center justify-between rounded-xl bg-white/[0.02] border border-white/[0.04] px-4 py-3">
                    <div class="flex items-center gap-3">
                        <span class="text-base">{{ '‚úÖ' if p.solved else '‚ùå' }}</span>
                        <div>
                            <span class="text-sm font-medium text-white">Puzzle {{ p.number }}</span>
                            <span class="text-[10px] text-gray-600 ml-2 uppercase tracking-widest">{{ p.type }}</span>
                        </div>
                    </div>
                    <div class="text-right text-xs text-gray-500">
                        {% if p.solved %}
                        {{ p.solve_time }}s &middot; {{ p.attempts }} att.
                        {% if p.hints_used > 0 %}
                        &middot; <span style="color: var(--accent);">{{ p.hints_used }} hint{{ 's' if p.hints_used != 1 else '' }}</span>
                        {% endif %}
                        {% else %}
                        <span class="text-gray-700">Not solved</span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Actions -->
    <div class="flex gap-3 animate-fade-in-delay">
        <a href="/"
           class="px-8 py-3 rounded-xl font-display font-semibold text-base text-[#09090b] transition-all duration-200 hover:brightness-110 active:scale-95"
           style="background: var(--accent);">
            Play Again
        </a>
    </div>

    <!-- Footer -->
    <p class="text-gray-700 text-xs mt-12">
        Powered by <span class="text-gray-500">Groq</span> ‚Äî every puzzle is uniquely generated
    </p>
</div>

<script>
// Theme-specific victory customization
document.addEventListener('DOMContentLoaded', () => {
    const VICTORY_DATA = {
        theoffice:   { title: 'Dundie Award Winner!', emoji: 'üèÜ' },
        friends:     { title: 'The One Where You Escaped!', emoji: '‚òï' },
        got:         { title: 'You Win the Iron Throne!', emoji: 'üëë' },
        parksandrec: { title: 'Treat Yo Self ‚Äî You Escaped!', emoji: 'üßá' },
        bigbang:     { title: 'Bazinga! You Escaped!', emoji: '‚öõÔ∏è' },
        breakingbad: { title: 'Say My Name ‚Äî You Escaped!', emoji: 'üß¨' },
        supernatural: { title: 'Carry On ‚Äî You Escaped!', emoji: 'üî•' },
    };
    const theme = '{{ theme }}';
    const data = VICTORY_DATA[theme];
    if (data) {
        const title = document.getElementById('victory-title');
        const emoji = document.getElementById('victory-emoji');
        if (title) title.textContent = data.title;
        if (emoji) emoji.textContent = data.emoji;
    }
});
</script>
{% endblock %}
