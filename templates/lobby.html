{% extends "base.html" %}

{% block title %}AI Escape Room — Choose Your Fate{% endblock %}

{% block content %}
<div class="min-h-screen px-4 py-16 max-w-6xl mx-auto">

    <!-- Hero -->
    <div class="text-center mb-16 animate-slide-up">
        <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-white/5 border border-white/10 text-xs font-medium text-gray-400 mb-6 backdrop-blur-sm">
            <span class="w-2 h-2 rounded-full bg-green-400 animate-pulse"></span>
            Powered by Gemini 3
        </div>
        <h1 class="font-display text-6xl md:text-7xl font-bold tracking-tight mb-4">
            <span class="bg-gradient-to-r from-white via-gray-200 to-gray-400 bg-clip-text text-transparent">
                AI Escape Room
            </span>
        </h1>
        <p class="text-gray-500 text-lg max-w-lg mx-auto leading-relaxed">
            Every puzzle is uniquely generated. Every playthrough is different.<br>
            <span class="text-gray-400">Can you escape before time runs out?</span>
        </p>
    </div>

    <!-- Classic Rooms Section -->
    <div class="mb-14 animate-fade-in">
        <div class="flex items-center gap-3 mb-6">
            <h2 class="font-display text-xl font-semibold text-white">Classic Rooms</h2>
            <div class="flex-1 h-px bg-gradient-to-r from-white/10 to-transparent"></div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            {% for key, theme in themes.items() %}
            {% if theme.category == 'classic' %}
            <button onclick="selectTheme('{{ key }}')" data-theme="{{ key }}"
                class="theme-card group relative overflow-hidden rounded-2xl border border-white/[0.06] bg-white/[0.02] p-6 text-left transition-all duration-500 hover:border-white/[0.12] hover:bg-white/[0.04] focus:outline-none focus:ring-2 focus:ring-white/20">
                <!-- Gradient orb -->
                <div class="absolute -top-20 -right-20 w-40 h-40 rounded-full opacity-0 group-hover:opacity-20 transition-opacity duration-700 blur-3xl"
                     style="background: {{ theme.gradient_to }};"></div>
                <div class="relative z-10">
                    <span class="text-4xl mb-3 block filter drop-shadow-lg">{{ theme.icon }}</span>
                    <h3 class="font-display text-lg font-semibold text-white mb-1 group-hover:text-gray-100 transition-colors">
                        {{ theme.name }}
                    </h3>
                    <p class="text-gray-500 text-sm leading-relaxed group-hover:text-gray-400 transition-colors">
                        {{ theme.tagline }}
                    </p>
                </div>
                <!-- Bottom accent -->
                <div class="absolute bottom-0 left-0 right-0 h-[2px] transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500 origin-left"
                     style="background: linear-gradient(90deg, {{ theme.gradient_from }}, {{ theme.gradient_to }});"></div>
            </button>
            {% endif %}
            {% endfor %}
        </div>
    </div>

    <!-- TV Shows Section -->
    <div class="mb-14 animate-fade-in-delay">
        <div class="flex items-center gap-3 mb-6">
            <h2 class="font-display text-xl font-semibold text-white">TV Shows & Movies</h2>
            <div class="flex-1 h-px bg-gradient-to-r from-white/10 to-transparent"></div>
            <span class="text-xs font-medium text-gray-500 bg-white/5 px-3 py-1 rounded-full border border-white/10">NEW</span>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            {% for key, theme in themes.items() %}
            {% if theme.category == 'tvshow' %}
            <button onclick="selectTheme('{{ key }}')" data-theme="{{ key }}"
                class="theme-card group relative overflow-hidden rounded-2xl border border-white/[0.06] bg-white/[0.02] p-6 text-left transition-all duration-500 hover:border-white/[0.12] hover:bg-white/[0.04] focus:outline-none focus:ring-2 focus:ring-white/20">
                <!-- Gradient orb -->
                <div class="absolute -top-20 -right-20 w-40 h-40 rounded-full opacity-0 group-hover:opacity-20 transition-opacity duration-700 blur-3xl"
                     style="background: {{ theme.gradient_to }};"></div>
                <div class="relative z-10">
                    <span class="text-4xl mb-3 block filter drop-shadow-lg">{{ theme.icon }}</span>
                    <h3 class="font-display text-lg font-semibold text-white mb-1 group-hover:text-gray-100 transition-colors">
                        {{ theme.name }}
                    </h3>
                    <p class="text-gray-500 text-sm leading-relaxed group-hover:text-gray-400 transition-colors">
                        {{ theme.tagline }}
                    </p>
                </div>
                <!-- Bottom accent -->
                <div class="absolute bottom-0 left-0 right-0 h-[2px] transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500 origin-left"
                     style="background: linear-gradient(90deg, {{ theme.gradient_from }}, {{ theme.gradient_to }});"></div>
            </button>
            {% endif %}
            {% endfor %}
        </div>
    </div>

    <!-- Loading overlay -->
    <div id="loading" class="hidden fixed inset-0 z-50 bg-[#09090b]/90 backdrop-blur-md flex flex-col items-center justify-center">
        <div class="relative mb-6">
            <div class="w-14 h-14 rounded-full border-2 border-white/10 border-t-white/60 animate-spin"></div>
        </div>
        <p class="text-gray-300 text-lg font-display font-medium" id="loading-text">Generating your escape room...</p>
        <p class="text-gray-600 text-sm mt-2">Gemini 3 is crafting unique puzzles</p>
    </div>

    <!-- Footer -->
    <div class="text-center text-gray-600 text-xs mt-8 space-y-1">
        <p>5 puzzles &middot; 15 minute timer &middot; Hints cost 60 seconds</p>
        <p class="text-gray-700">Built with Gemini 3 for the Google DeepMind Hackathon</p>
    </div>
</div>

<script>
async function selectTheme(theme) {
    const cards = document.querySelectorAll('.theme-card');
    cards.forEach(c => {
        c.disabled = true;
        c.style.pointerEvents = 'none';
        if (c.dataset.theme !== theme) {
            c.style.opacity = '0.15';
            c.style.transform = 'scale(0.97)';
        } else {
            c.style.borderColor = 'rgba(255,255,255,0.2)';
        }
    });
    document.getElementById('loading').classList.remove('hidden');

    const messages = [
        'Generating your escape room...',
        'Crafting puzzles with Gemini 3...',
        'Building the first challenge...',
        'Almost ready...'
    ];
    let msgIdx = 0;
    const msgInterval = setInterval(() => {
        msgIdx = (msgIdx + 1) % messages.length;
        document.getElementById('loading-text').textContent = messages[msgIdx];
    }, 2500);

    try {
        const resp = await fetch('/start', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ theme }),
        });
        const data = await resp.json();
        clearInterval(msgInterval);
        if (data.success) {
            window.location.href = data.redirect;
        } else {
            alert(data.error || 'Failed to start game. The AI might be busy — try again.');
            window.location.reload();
        }
    } catch (err) {
        clearInterval(msgInterval);
        alert('Connection error. Please try again.');
        window.location.reload();
    }
}
</script>
{% endblock %}
